PRINT @(-1):"MVDBTOOLKIT.TEST"
PRINT


CMND=SENTENCE()
TEST.PLATFORM=FIELD(CMND,' ',2)
TEST.MVTYPE=FIELD(CMND,' ',3)

WOBJ.RTNE="MVDBTOOLKIT.WOBJ"

* GET ENVIRONMENT
CALL MVDBTOOLKIT.WPLATFORM(PLATFORM.OBJ)

CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","platform",PLATFORM,"",RERR)
TEST='platform'; GOSUB start.test
TEST.MSG=PLATFORM:"=":TEST.PLATFORM
IF PLATFORM # TEST.PLATFORM THEN TEST.STATUS=0 ELSE TEST.STATUS=1
GOSUB end.test

CALL @WOBJ.RTNE(PLATFORM.OBJ,"GET","mvtype",RESULT,"",RERR)
TEST='mvtype'; GOSUB start.test
TEST.MSG=RESULT:"=":TEST.MVTYPE
IF RESULT # TEST.MVTYPE THEN TEST.STATUS=0 ELSE TEST.STATUS=1
GOSUB end.test

* Test 1 Getenv
TEST="parse"
GOSUB start.test
CALL MVDBTOOLKIT.WGETENV("PATH",PATH)
IF PATH # "" THEN
    TEST.MSG=PATH[1,60]
    TEST.STATUS=1
END ELSE
    TEST.MSG=""
    TEST.STATUS=0
END
GOSUB end.test

TEST="WCALL.RESPONSECODE"
GOSUB start.test

CALL @WOBJ.RTNE(OBJ,"FROMSTRING","","{}","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","method","POST","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","url","https://httpbin.org/anything?field1=value1","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","insecure","Y","",RERR)
 
 CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","headers","{}","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","headers.X-TEST-HEADER","headertest","",RERR)
 
 CALL @WOBJ.RTNE(OBJ,"SET.ARRAY","formfields","[]","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","formfields[-1]","{}","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","formfields[0].name","field2","",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET","formfields[0].value","VALUE2$","",RERR)
 
 CALL @WOBJ.RTNE(SOBJ,"FROMSTRING","","{}","",RERR)
 CALL @WOBJ.RTNE(SOBJ,"SET","name","field3","",RERR)
 CALL @WOBJ.RTNE(SOBJ,"SET","value","<EXAMPLE HTML>","",RERR)
 CALL @WOBJ.RTNE(SOBJ,"TOSTRING","",SJSON,"",RERR)
 CALL @WOBJ.RTNE(OBJ,"SET.OBJECT","formfields[-1]",SJSON,"",RERR)
 
 
 CALL MVDBTOOLKIT.WCALL(OBJ)

 CALL @WOBJ.RTNE(OBJ,"GET","response.data",RESPONSE,"",RERR)
 *PRINT "RESPONSE=":RESPONSE
 
 CALL @WOBJ.RTNE(OBJ,"GET","response.status",RESPONSE.STATUS,"",RERR)
 *PRINT 'RESPONSE.STATUS=':RESPONSE.STATUS:'  ':
 *IF RESPONSE.STATUS="200" THEN PRINT "OK" ELSE PRINT "FAIL"
 TEST.MSG=RESPONSE.STATUS
 IF RESPONSE.STATUS="200" THEN
    TEST.STATUS=1
 END ELSE
    TEST.STATUS=0
 END
 GOSUB end.test

 GOSUB start.test
 TEST='WCALL.HTTPTYPE'
 CALL @WOBJ.RTNE(OBJ,"GET","response.http_type",RESPONSE.HTTP.TYPE,"",RERR)
 *PRINT 'RESPONSE.HTTP_TYPE=':RESPONSE.HTTP.TYPE
 TEST.MSG=RESPONSE.HTTP.TYPE
 IF TEST.MSG="HTTP/1.1" THEN
    TEST.STATUS=1
 END ELSE
    TEST.STATUS=0
 END
 GOSUB end.test

STOP
*
GOSUB start.test
RETURN
*
process.error: *
IF RERR<1> THEN
   TEST.STATUS=-1
   TEST.MSG=RERR<1>
END
RETURN
*
*
start.test: *
TEST.STATUS=0
TEST.MSG="Success"
PRINT "Test: ":TEST[1,20]"L(#20)":
RETURN
*
end.test: *
PRINT "  ":TEST.MSG[1,60]"L(#60)":
PRINT " ":
IF TEST.STATUS THEN PRINT "[Ok    ]" ELSE PRINT @(-13):"[Failed]":@(-14)
RETURN


 
